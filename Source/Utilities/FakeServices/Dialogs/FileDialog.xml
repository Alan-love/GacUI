<Folder>
  <Instance name="FilePickerControl">
    <Instance ref.CodeBehind="false" ref.Class="gaclib_controls::FilePickerControl">
      <ref.LocalizedStrings Name="Strings" Class="gaclib_controls::DialogStrings" Default="true"/>
      <ref.Parameter Name="ViewModel" Class="presentation::IFileDialogViewModel"/>
      <ref.Ctor><![CDATA[
        {
          ViewModel.InitLocalizedText(
              self.Strings.FileDialogTextLoadingFolders(),
              self.Strings.FileDialogTextLoadingFiles(),
              self.Strings.FileDialogErrorFileNotExist(),
              self.Strings.FileDialogErrorFileExpected(),
              self.Strings.FileDialogErrorFolderNotExist(),
              self.Strings.FileDialogErrorMultipleSelectionNotEnabled(),
              self.Strings.FileDialogAskCreateFile(),
              self.Strings.FileDialogAskOverrideFile()
            );
          treeView.ItemSource = ViewModel.RootFolder;
          listView.ItemSource = ViewModel.Files;
          ViewModel.RefreshFiles();
        }
      ]]></ref.Ctor>
      <CustomControl ref.Name="self">
        <Table AlignmentToParent="left:0 top:0 right:0 bottom:0" BorderVisible="false" CellPadding="5" MinSizeLimitation="LimitToElementAndChildren">
          <att.Rows>
            <_>composeType:Percentage percentage:1.0</_>
          </att.Rows>
          <att.Columns>
            <_>composeType:Percentage percentage:1.0</_>
          </att.Columns>

          <Table AlignmentToParent="left:0 top:0 right:0 bottom:0" BorderVisible="false" CellPadding="5" MinSizeLimitation="LimitToElementAndChildren">
            <att.Rows>
              <_>composeType:Percentage percentage:1.0</_>
            </att.Rows>
            <att.Columns>
              <_>composeType:Absolute absolute:192</_>
              <_>composeType:Percentage percentage:1.0</_>
            </att.Columns>

            <ColumnSplitter ColumnsToTheLeft="1"/>

            <Cell Site="row:0 column:0">
              <BindableTreeView ref.Name="treeView" env.ItemType="IFileDialogFolder^" VerticalAlwaysVisible="false" HorizontalAlwaysVisible="false">
                <att.BoundsComposition-set AlignmentToParent="left:0 top:0 right:0 bottom:0"/>
                <att.TextProperty>Name</att.TextProperty>
                <att.ChildrenProperty>Folders</att.ChildrenProperty>
              </BindableTreeView>
            </Cell>

            <Cell Site="row:0 column:1">
              <BindableListView ref.Name="listView" env.ItemType="IFileDialogFile^" View="ListViewView::List" VerticalAlwaysVisible="false" HorizontalAlwaysVisible="false">
                <att.BoundsComposition-set AlignmentToParent="left:0 top:0 right:0 bottom:0"/>
                <att.Columns>
                  <ListViewColumn TextProperty="Name"/>
                </att.Columns>
              </BindableListView>
            </Cell>
          </Table>
        </Table>
      </CustomControl>
    </Instance>
  </Instance>

  <Instance name="FileDialogWindowResource">
    <Instance ref.CodeBehind="false" ref.Class="gaclib_controls::FileDialogWindow" xmlns:g="gaclib_controls::*">
      <ref.LocalizedStrings Name="Strings" Class="gaclib_controls::DialogStrings" Default="true"/>
      <ref.Parameter Name="ViewModel" Class="presentation::IFileDialogViewModel"/>
      <ref.Members><![CDATA[
        func MakeOpenFileDialog() : void
        {
          buttonOK.Text = Strings.FileDialogOpen();
        }
        
        func MakeSaveFileDialog() : void
        {
          buttonOK.Text = Strings.FileDialogSave();
        }
      ]]></ref.Members>
      <Window
          ref.Name = "self"
          Text-eval="ViewModel.Title"
          ClientSize="x:480 y:360"
          ShowInTaskBar="false"
          MaximizedBox="false"
          MinimizedBox="false"
          IconVisible="false"
          >
        <Table AlignmentToParent="left:0 top:5 right:0 bottom:0" BorderVisible="false" CellPadding="5" MinSizeLimitation="LimitToElementAndChildren">
          <att.Rows>
            <_>composeType:Percentage percentage:1.0</_>
            <_>composeType:MinSize</_>
          </att.Rows>
          <att.Columns>
            <_>composeType:Percentage percentage:1.0</_>
            <_>composeType:MinSize</_>
            <_>composeType:MinSize</_>
          </att.Columns>

          <Cell Site="row:0 column:0 rowSpan:1 columnSpan:3">
            <g:FilePickerControl ViewModel-eval="ViewModel">
              <att.BoundsComposition-set AlignmentToParent="left:0 top:0 right:0 bottom:0"/>
            </g:FilePickerControl>
          </Cell>

          <Cell Site="row:1 column:1">
            <Button ref.Name="buttonOK" Enabled-bind="not ViewModel.IsLoadingFiles">
              <att.BoundsComposition-set AlignmentToParent="left:0 top:0 right:0 bottom:0" PreferredMinSize="x:80 y:24"/>
              <ev.Clicked-eval><![CDATA[
                {
                  self.Close();
                }
              ]]></ev.Clicked-eval>
            </Button>
          </Cell>

          <Cell Site="row:1 column:2">
            <Button Text-str="Cancel()">
              <att.BoundsComposition-set AlignmentToParent="left:0 top:0 right:0 bottom:0" PreferredMinSize="x:80 y:24"/>
              <ev.Clicked-eval><![CDATA[
                {
                  self.Close();
                }
              ]]></ev.Clicked-eval>
            </Button>
          </Cell>
        </Table>
      </Window>
    </Instance>
  </Instance>
</Folder>