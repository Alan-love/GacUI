# 1.3.0.0

## Fixed
- `DocumentModel::SaveToXml` double space characters.
- `IGuiGraphicsParagraph` rendering and caret calculation bugs on GDI.

## Breaking Changes
- Delete `GuiSinglelineTextBox` and `GuiMultilineTextBox`.
  - A new `GuiSinglelineTextBox` will be created, inheriting from `GuiDocumentLabel`.
  - A new `GuiMultilineTextBox` will be created, inheriting from `GuiDocumentViewer`.

## New Features
- `GuiDocumentLabel` and `GuiDocumentViewer` accept `GuiDocumentConfig` to control document editing and rendering behavior.
- `GuiDocumentLabel` and `GuiDocumentViewer` offer `ConvertToPlainText`.
- Add `PasswordChar` to `GuiDocumentCommonInterface`, set to `\0` to disable.

## Copilot

- `kb-design.prompt.md`:
  - Adding a new control
  - UI Operations:
    - Tab, Alt
    - Event Propagation
  - Menu interaction between owner and sub item
  - List control architecture
    - Layout
    - Virtual item management
    - Tree item management
  - XML Compiler topics ...

## Known Issues

- `GuiMultilineTextBox`
  - It becomes slow when loading huge amount of text like `Test\Resources\UnitTestSnapshots\Controls\Ribbon\GuiRibbonButtons\Dropdowns.json`.
    - Paragraph mode performance will be unacceptable because:
      - the whole text is loaded into one single `IGuiGraphicsParagraph`.
      - `GuiDocumentCommonInterface::UserInput_FormatText` takes too long (in `config.doubleLineBreaksBetweenParagraph`).
  - Dragging to select also slow.
- UnitTestSnapshotViewer
  - It becomes slow when loading a large test case like `Test\Resources\UnitTestSnapshots\Controls\Ribbon\GuiRibbonButtons\Dropdowns.json`.
  - `UnitTestSnapshotFileNode::EnsureLoaded`, `JsonParse` takes too much time.

## Milestone

- Make a general framework for `InjectXXXImpl` and `IXXXImpl`, so that each injected implementation could access the previous implementation, and ensured ejection in order. An ejection could happen in any level so that all dependents are ejected.
- `GuiDocumentElementRenderer` performance issue
  - Rewrite all update functions for text processor.
    - Using `MemoryStream` directly instead of string concat.
  - Extract `IGuiGraphicsParagrapg` cache list to a separated class so that not all data are opened
    - Never create a paragraph until it is being rendered.
    - All paragraph will now have a minimum height which is the default height for empty document
    - `GetCaretBounds` will return an estimated value, it could change when the control scrolls to ensure visible, need to repeat until eventually visible.
  - Add a new option `recycleParagraph`, when it is true, a `IGuiGraphicsParagraph` outside of the view will be released, keeping only the last height.
    - This option will be enabled by default.
- Document
  - `GuiSinglelineTextBox` and `GuiMultilineTextBox`
    - `Select` -> `SetCaret`
    - `Readonly` -> `EditMode`
