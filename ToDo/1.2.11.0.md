# 1.2.11.0

## Completed

- Fixed:
  - `#include <arm_acle.h>` is needed for `__yield` in `VlppOS.cpp`
  - Calling `GuiControlHost::Close()` skipped the last batch of async tasks.
- Added:
  - `IGuiRemoteProtocolChannel<TPackage>` and `IGuiRemoteProtocolChannelReceiver<TPackage>`
  - `GuiRemoteProtocolFromJsonChannel` creates `IGuiRemoteProtocol` from `IGuiRemoteProtocolChannel<Ptr<JsonNode>>`
  - `GuiRemoteJsonChannelFromProtocol` creates `IGuiRemoteProtocolChannel<Ptr<JsonNode>>` from `IGuiRemoteProtocol`
  - `SetupRawWindowsDirect2DRenderer`
  - `SetupRawWindowsGDIRenderer`

## Milestone

- GacUI
  - Fix `Global Objects` in `GacUI.h`.
  - For diff-disabled (default) unit tests, it calls diff function explicitly to log both rendering/diff commands.
    - Call `UpdateDomInplace` to verify results.
  - Mouse wheel trigger functions.
  - Unit Test Snapshot Viewer
    - Show dom nodes in a tree view in the right side of the rendering tab optionally.
    - Select dom node and jump to other tabs with highlight.
- Remote protocol
  - Investigate about generating data structure in flat memory layout, so that no effort needed for binary serialization 
- Remote protocol channel
  - [x] `IGuiRemoteProtocolChannel<TPackage>` and `IGuiRemoteProtocolChannelReceiver<TPackage>`.
  - Json channel
    - [x] `GuiRemoteProtocolFromJsonChannel` creates `IGuiRemoteProtocol` from `IGuiRemoteProtocolChannel<Ptr<JsonNode>>`.
    - [x] `GuiRemoteJsonChannelFromProtocol` creates `IGuiRemoteProtocolChannel<Ptr<JsonNode>>` from `IGuiRemoteProtocol`.
    - [x] Unit test
  - [ ] Binary channel
  - [x] Json to `ObjectString<T>` channel conversion
  - [x] Sync to Async channel conversion
    - [ ] Test sending disconnect or other events when `Submit()` is pending on the event.
      - Support failure injection in unit test, making `UnitTestRemoteProtocol::Submit()` returns `true` to its `disconnected` parameter.
    - [ ] `Start` -> `StartWithUIThread` and `StartWithUIAndChannelThread`.
      - Move all UI and channel thread resources to two structs for easy refactoring.
      - The `StartWithUIThread` is useful when channel communication does not require to be done in a single thread, everything will be called from the UI thread and the receiver could be called from any non-UI thread.
- Remote protocol redirection back to native rendering:
  - `RemotingTest_Core`
  - `RemotingTest_Rendering_Win32`
  - [x] [NamedPipe](https://learn.microsoft.com/en-us/windows/win32/ipc/named-pipe-server-using-overlapped-i-o)
    - Disallow disconnect and reconnect.
    - [ ] Use string first, and then change to binary.
  - [ ] [HttpServer](https://learn.microsoft.com/en-us/windows/win32/http/using-http-server-api)
    - Allow only one client by verifying a random guid in the message which is given from the registration request.
    - Allow disconnect and reconnect.
    - When TypeScript rendering is completed, the demo in `Release` repo would become a website server.
  - [ ] [HttpClient](https://learn.microsoft.com/en-us/windows/win32/winhttp/winhttp-start-page)
- Implement the remote protocol on a native `INativeController` instance. It could not be used on `GuiHostedController` or `GuiRemoteController`, which is not a native implementation.
  - `SetupRawWindowsGDIRenderer` black screen
  - Resizing the main window
    - Handle MinSize (`1.2.13.0`)
    - Repaint
  - Measuring information sent from Rendering to Core even when there is no requirement or size changing
    - Measuring result of the same font repeats in `fontHeights`
  - Global shortcut key not handled
  - Display error when core crashes or stops unexpectedly
    - Inject error from a button in the home page
    - Switch the window back to non-custom border to offer a chance for existing
  - When the image is assigned to a control before connected
    - `GuiImageFrameElement::SetImage` does nothing because `GetFrameCount` returns 0
    - after connected controls display no images
- `UpdateDomInplace` performed binary search, create a common implementation to share with `SortedList`.
- `GuiRemoteProtocolFromJsonChannel::OnReceive` should use a map instead of a series of if-statments.
- `GuiRemoteJsonChannelFromProtocol::Write` should use a map instead of a series of if-statments.
- `vl::presentation::remoteprotocol::channeling::ConvertUtfString` move into `Vlpp` repo.
- Hosted mode
  - All sub windows seem to have max/min button rendered, need to fix.
- GacUI
  - Test on all platforms to call main window's `Close` method from a button and see if it works:
    - Windows
    - Hosted
    - Remote
  - Test on all platforms to call main window's `Close` method with a message box and see if there is any memory leaks:
    - Windows
    - Hosted
    - Remote
- Document
  - `SetupRawWindowsDirect2DRenderer`
  - `SetupRawWindowsGDIRenderer`
